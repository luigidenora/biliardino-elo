import"./modulepreload-polyfill-B5Qt9EMX.js";import{w as I}from"./auth.util-DTc4Y7u9.js";import{g as B,e as v,s as y,d as T,a as E,b as i}from"./match.service-8YMje7wm.js";import"./firebase-BkA1I5aN.js";function N(b){const t=new Date(b),a=["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][t.getDay()],s=t.getDate().toString().padStart(2,"0"),o=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getFullYear();return`${a}, ${s}/${o}/${r}`}const $=["teamA-defence","teamA-attack","teamB-defence","teamB-attack"],A=["scoreA","scoreB"];class n{static _editingMatchId=null;static init(){n.populateSelects(),n.bindFormSubmit(),n.renderAllMatches()}static populateSelects(){const e=[...B()].sort((s,o)=>s.name.localeCompare(o.name)),a=n.getAllTeamSelects();for(const s of a){s.innerHTML='<option value="">-- select player --</option>';for(const o of e){const r=document.createElement("option");r.value=o.id.toString(),r.textContent=o.name,s.appendChild(r)}}}static bindFormSubmit(){n.getForm().addEventListener("submit",n.handleSubmit)}static async handleSubmit(t){t.preventDefault();const e=n.getMessageEl();e.textContent="";try{const a=n.getAllTeamSelects(),s=Number.parseInt(a[0].value),o=Number.parseInt(a[1].value),r=Number.parseInt(a[2].value),c=Number.parseInt(a[3].value);if(!s||!o||!r||!c)throw new Error("Please select all four players.");const l=n.getScoreInputs(),m=Number(l[0].value),d=Number(l[1].value);if(Number.isNaN(m)||Number.isNaN(d))throw new TypeError("Please enter valid numeric scores.");const u=[s,o,r,c];if(new Set(u).size!==u.length)throw new Error("The same player cannot be selected more than once in the match.");const g={defence:s,attack:o},f={defence:r,attack:c},p=n._editingMatchId;let S;if(p){const h=v(p,g,f,[m,d]);await y(h),e.textContent="Match updated successfully."}else S=T(g,f,[m,d]),await y(S),e.textContent="Match saved successfully.";n._editingMatchId=null,n.renderAllMatches(),t.target.reset()}catch(a){console.error(a),e.textContent=a instanceof Error?a.message:"Failed to save match."}}static renderAllMatches(){const t=n.getAddedMatchesTable(),e=t.querySelector("tbody")??t.createTBody();e.innerHTML="";const a=E();for(const s of a){const o=n.createMatchRow(s);e.appendChild(o)}}static createMatchRow(t){const e=document.createElement("tr");e.dataset.matchId=t.id.toString();const a=i(t.teamA.defence).name,s=i(t.teamA.attack).name,o=i(t.teamB.defence).name,r=i(t.teamB.attack).name;e.innerHTML=`
      <td>${a} / ${s}</td>
      <td>${o} / ${r}</td>
      <td>${t.score[0]} - ${t.score[1]}</td>
      <td>${N(t.createdAt)}</td>
      <td><button type="button" class="edit-match">Edit</button></td>
    `;const c=e.querySelector(".edit-match");return c&&c.addEventListener("click",()=>n.startEditing(t.id)),n._editingMatchId===t.id&&e.classList.add("editing"),e}static startEditing(t){const e=E().find(l=>l.id===t);if(!e){console.error("Match to edit not found:",t);return}n._editingMatchId=t;const a=n.getAllTeamSelects();a[0].value=e.teamA.defence.toString(),a[1].value=e.teamA.attack.toString(),a[2].value=e.teamB.defence.toString(),a[3].value=e.teamB.attack.toString();const[s,o]=e.score,r=n.getScoreInputs();r[0].value=String(s),r[1].value=String(o),n.renderAllMatches();const c=n.getMessageEl();c.textContent="Editing existing match..."}static getForm(){const t=document.getElementById("add-match-form");if(!t)throw new Error("Wrong add-match form id");return t}static getAllTeamSelects(){return $.map(t=>{const e=document.getElementById(t);if(!e)throw new Error(`Wrong team select id: ${t}`);return e})}static getScoreInputs(){return A.map(t=>{const e=document.getElementById(t);if(!e)throw new Error(`Wrong score input id: ${t}`);return e})}static getMessageEl(){const t=document.getElementById("message");if(!t)throw new Error("Wrong message span id");return t}static getAddedMatchesTable(){const t=document.getElementById("added-matches");if(!t)throw new Error("Wrong added matches table id");return t}}async function C(){n.init()}I(C);
